addons:
  apt:
    sources:
    - avsm
    - llvm-toolchain-precise-3.8
    packages:
    - build-essential
    - python-software-properties
    - opam
    - m4
    - pkg-config
    - make
    - cmake
    - gcc

cache:
  directories:
  - $HOME/llvm

install:
  - wget http://llvm.org/releases/3.8.0/llvm-3.8.0.src.tar.xz
  - tar -xf llvm-3.8.0.src.tar.xz
  - cd llvm-3.8.0.src
  - mkdir -v build &&
    cd       build &&
    CC=gcc CXX=g++                              \
    cmake -DCMAKE_INSTALL_PREFIX=--prefix=$HOME/llvm           \
          -DLLVM_ENABLE_FFI=ON                  \
          -DCMAKE_BUILD_TYPE=Release            \
          -DBUILD_SHARED_LIBS=ON                \
          -DLLVM_TARGETS_TO_BUILD="host;AMDGPU" \
          -Wno-dev ..                           &&
    make
  - make install

before_script:
  - export PATH=$PATH:$HOME/llvm
  - opam init -y
  - eval $(opam config env)
  - opam install ocamlfind -y
  - opam install llvm -y

script:
  - export PATH=$PATH:$HOME/llvm
  - make all
